<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>connection (postgresql.Postgresql.connection)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">postgresql</a> &#x00BB; <a href="../index.html">Postgresql</a> &#x00BB; connection</nav><h1>Class <code>Postgresql.connection</code></h1><p>Class of connections.</p><p>When <code>conninfo</code> is given, it will be used instead of all other optional arguments.</p><dl><dt>parameter startonly</dt><dd><p>If true, initiate a non-blocking connect procedure, which involves cooperative calls to <a href="index.html#method-connect_poll"><code>connect_poll</code></a> before the connection is usable.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection failure.</p></dd></dl></header><dl><dt class="spec method" id="method-finish"><a href="#method-finish" class="anchor"></a><code><span class="keyword">method</span> finish : unit</code></dt><dd><p><code>#finish</code> closes the connection.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-try_reset"><a href="#method-try_reset" class="anchor"></a><code><span class="keyword">method</span> try_reset : unit</code></dt><dd><p><code>#try_reset</code> tries to reset the connection if it is bad. If resetting fails, the <code>error</code> exception will be raised with <code>Connection_failure</code>.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-reset"><a href="#method-reset" class="anchor"></a><code><span class="keyword">method</span> reset : unit</code></dt><dd><p><code>#reset</code> resets the connection.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><aside><p>Asynchronous Notification</p></aside><dl><dt class="spec method" id="method-notifies"><a href="#method-notifies" class="anchor"></a><code><span class="keyword">method</span> notifies : <span><a href="../Notification/index.html#type-t">Notification.t</a> option</span></code></dt><dd><p><code>#notifies</code></p><dl><dt>returns</dt><dd><p><code>Some notification</code> if available (<code>None</code> otherwise).</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><aside><p>Control Functions</p></aside><dl><dt class="spec method" id="method-set_notice_processor"><a href="#method-set_notice_processor" class="anchor"></a><code><span class="keyword">method</span> set_notice_processor : <span>(string <span>&#45;&gt;</span> unit)</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>#set_notice_processor</code> controls reporting of notice and warning messages generated by a connection.</p><p><em>Warning:</em> This function is unsafe in combination with a number of libpq entry points, and should not be used for now. As a workaround, <code>#set_notice_processing</code> can be used to silence notices, if this is more appropriate than the default behaviour of printing them to standard error.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-set_notice_processing"><a href="#method-set_notice_processing" class="anchor"></a><code><span class="keyword">method</span> set_notice_processing : <span>[ `Stderr <span>| `Quiet</span> ]</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>#set_notice_processing</code> controls reporting of notice and warning messages generated by a connection by providing predefined callbacks.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><aside><p>Accessors</p></aside><dl><dt class="spec method" id="method-db"><a href="#method-db" class="anchor"></a><code><span class="keyword">method</span> db : string</code></dt><dd><p><code>#db</code></p><dl><dt>returns</dt><dd><p>database name of the connection.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-user"><a href="#method-user" class="anchor"></a><code><span class="keyword">method</span> user : string</code></dt><dd><p><code>#user</code></p><dl><dt>returns</dt><dd><p>user name of the connection.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-pass"><a href="#method-pass" class="anchor"></a><code><span class="keyword">method</span> pass : string</code></dt><dd><p><code>#pass</code></p><dl><dt>returns</dt><dd><p>password of the connection.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-host"><a href="#method-host" class="anchor"></a><code><span class="keyword">method</span> host : string</code></dt><dd><p><code>#host</code></p><dl><dt>returns</dt><dd><p>server host name of the connection.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-port"><a href="#method-port" class="anchor"></a><code><span class="keyword">method</span> port : string</code></dt><dd><p><code>#port</code></p><dl><dt>returns</dt><dd><p>port of the connection.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-tty"><a href="#method-tty" class="anchor"></a><code><span class="keyword">method</span> tty : string</code></dt><dd><p><code>#tty</code></p><dl><dt>returns</dt><dd><p>debug tty of the connection.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-options"><a href="#method-options" class="anchor"></a><code><span class="keyword">method</span> options : string</code></dt><dd><p><code>#options</code></p><dl><dt>returns</dt><dd><p>backend options of the connection.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-status"><a href="#method-status" class="anchor"></a><code><span class="keyword">method</span> status : <a href="../index.html#type-connection_status">connection_status</a></code></dt><dd><p><code>#status</code></p><dl><dt>returns</dt><dd><p>current connection status.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-error_message"><a href="#method-error_message" class="anchor"></a><code><span class="keyword">method</span> error_message : string</code></dt><dd><p><code>#error_message</code></p><dl><dt>returns</dt><dd><p>most recent error message of the connection.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-backend_pid"><a href="#method-backend_pid" class="anchor"></a><code><span class="keyword">method</span> backend_pid : int</code></dt><dd><p><code>#backend</code></p><dl><dt>returns</dt><dd><p>process id of the backend server of the connection.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-server_version"><a href="#method-server_version" class="anchor"></a><code><span class="keyword">method</span> server_version : int * int * int</code></dt></dl><aside><p>Commands and Queries</p></aside><dl><dt class="spec method" id="method-empty_result"><a href="#method-empty_result" class="anchor"></a><code><span class="keyword">method</span> empty_result : <a href="../index.html#type-result_status">result_status</a> <span>&#45;&gt;</span> <a href="../class-type-result/index.html">result</a></code></dt><dd><p><code>empty_result stat</code></p><dl><dt>returns</dt><dd><p>dummy result with a given status <code>stat</code>.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-exec"><a href="#method-exec" class="anchor"></a><code><span class="keyword">method</span> exec : <span>?&#8288;expect:<span><a href="../index.html#type-result_status">result_status</a> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;param_types:<span><a href="../index.html#type-oid">oid</a> array</span></span> <span>&#45;&gt;</span> <span>?&#8288;params:<span>string array</span></span> <span>&#45;&gt;</span> <span>?&#8288;binary_params:<span>bool array</span></span> <span>&#45;&gt;</span> <span>?&#8288;binary_result:bool</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="../class-type-result/index.html">result</a></code></dt><dd><p><code>exec ?expect ?params ?param_types ?binary_params ?binary_result query</code> synchronous execution of query or command <code>query</code>. The result status will be checked against all elements in <code>expect</code>. If <code>expect</code> is not empty and if there is no match, the exception <code>Unexpected_status</code> will be raised.</p><p>Additional query parameters can be passed in the <code>params</code> array. They must not be escaped and they can be referred to in <code>query</code> as $1, $2, ... The value <code>null</code> can be used in the <code>params</code> array to denote an SQL NULL. It is possible to specify that some of the query parameters are passed as binary strings using the <code>binary_params</code> array. By default, results are returned in text format, but will be returned in binary format if <code>binary_result</code> is true.</p><p>If no (or an empty) query parameter is passed, it is possible to emit several commands with a single call.</p><dl><dt>returns</dt><dd><p>result of query.</p></dd></dl><dl><dt>parameter expect</dt><dd><p>default = <code></code></p></dd></dl><dl><dt>parameter param_types</dt><dd><p>default = <code>||</code></p></dd></dl><dl><dt>parameter params</dt><dd><p>default = <code>||</code></p></dd></dl><dl><dt>parameter binary_params</dt><dd><p>default = <code>||</code></p></dd></dl><dl><dt>parameter binary_result</dt><dd><p>default = false</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is an unexpected result status.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-prepare"><a href="#method-prepare" class="anchor"></a><code><span class="keyword">method</span> prepare : <span>?&#8288;param_types:<span><a href="../index.html#type-oid">oid</a> array</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="../class-type-result/index.html">result</a></code></dt><dd><p><code>prepare ?param_types stm_name query</code> creates a prepared query named <code>stm_name</code> which will execute the query or command <code>query</code> when passed to <code>#exec_prepared</code>.</p></dd></dl><dl><dt class="spec method" id="method-exec_prepared"><a href="#method-exec_prepared" class="anchor"></a><code><span class="keyword">method</span> exec_prepared : <span>?&#8288;expect:<span><a href="../index.html#type-result_status">result_status</a> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;params:<span>string array</span></span> <span>&#45;&gt;</span> <span>?&#8288;binary_params:<span>bool array</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="../class-type-result/index.html">result</a></code></dt><dd><p><code>exec_prepared ?expect ?params ?binary_params stm_name</code> acts as <code>#exec</code>, except executes the prepared query <code>stm_name</code>.</p></dd></dl><dl><dt class="spec method" id="method-describe_prepared"><a href="#method-describe_prepared" class="anchor"></a><code><span class="keyword">method</span> describe_prepared : string <span>&#45;&gt;</span> <a href="../class-type-result/index.html">result</a></code></dt><dd><p><code>#describe_prepared stm_name</code> submits a request to obtain information about the specified prepared statement, and waits for completion. <a href="index.html#method-describe_prepared"><code>describe_prepared</code></a> allows an application to obtain information about a previously prepared statement. The <code>stm_name</code> parameter can be the empty string (&quot;&quot;) to reference the unnamed statement, otherwise it must be the name of an existing prepared statement. On success, a <a href="../class-type-result/index.html"><code>result</code></a> with status <code>Command_ok</code> is returned. The methods <a href="../class-type-result/index.html#method-nparams"><code>result.nparams</code></a> and <a href="../class-type-result/index.html#method-paramtype"><code>result.paramtype</code></a> of the class <code>result</code> can be used to obtain information about the parameters of the prepared statement, and the methods <a href="../class-type-result/index.html#method-nfields"><code>result.nfields</code></a>, <a href="../class-type-result/index.html#method-fname"><code>result.fname</code></a> and <a href="../class-type-result/index.html#method-ftype"><code>result.ftype</code></a> provide information about the result columns (if any) of the statement.</p><p>To prepare a statement use the SQL command PREPARE.</p><dl><dt>parameter stm_name</dt><dd><p>The name of the previously prepared query</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl><dl><dt>see <a href="http://www.postgresql.org/docs/8.3/interactive/sql-prepare.html">http://www.postgresql.org/docs/8.3/interactive/sql-prepare.html</a></dt><dd><p>PostgreSQL documentation about <code>PREPARE</code></p></dd></dl></dd></dl><dl><dt class="spec method" id="method-send_query"><a href="#method-send_query" class="anchor"></a><code><span class="keyword">method</span> send_query : <span>?&#8288;param_types:<span><a href="../index.html#type-oid">oid</a> array</span></span> <span>&#45;&gt;</span> <span>?&#8288;params:<span>string array</span></span> <span>&#45;&gt;</span> <span>?&#8288;binary_params:<span>bool array</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>send_query ?param_types ?params ?binary_params query</code> asynchronous execution of query or command <code>query</code>.</p><p>Additional query parameters can be passed in the <code>params</code> array. They must not be escaped and they can be referred to in <code>query</code> as $1, $2, ... The value <code>null</code> can be used in the <code>params</code> array to denote an SQL NULL. It is possible to specify that some of the query parameters are passed as binary strings using the <code>binary_params</code> array.</p><p>If no (or an empty) query parameter is passed, it is possible to emit several commands with a single call.</p><dl><dt>parameter param_types</dt><dd><p>default = <code>||</code></p></dd></dl><dl><dt>parameter params</dt><dd><p>default = <code>||</code></p></dd></dl><dl><dt>parameter binary_params</dt><dd><p>default = <code>||</code></p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-send_prepare"><a href="#method-send_prepare" class="anchor"></a><code><span class="keyword">method</span> send_prepare : <span>?&#8288;param_types:<span><a href="../index.html#type-oid">oid</a> array</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>#send_prepare ?param_types stm_name query</code> sends a query preparation without waiting for the result. This does the same as <a href="index.html#method-prepare"><code>prepare</code></a> except that the status is reported by <a href="index.html#method-get_result"><code>get_result</code></a> when available.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-send_query_prepared"><a href="#method-send_query_prepared" class="anchor"></a><code><span class="keyword">method</span> send_query_prepared : <span>?&#8288;params:<span>string array</span></span> <span>&#45;&gt;</span> <span>?&#8288;binary_params:<span>bool array</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>#send_query_prepared ?params ?binary_params stm_name</code> is an asynchronous version of <code>query_prepared</code>. The semantics is otherwise the same, and the result is reported by <a href="index.html#method-get_result"><code>get_result</code></a> when available.</p><dl><dt>parameter params</dt><dd><p>default = <code>||</code></p></dd></dl><dl><dt>parameter binary_params</dt><dd><p>default = <code>||</code></p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-send_describe_prepared"><a href="#method-send_describe_prepared" class="anchor"></a><code><span class="keyword">method</span> send_describe_prepared : string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>#send_describe_prepared stm_name</code> sends a request for a description of a prepared query without waiting for the result. The result must be fetched with <a href="index.html#method-get_result"><code>get_result</code></a> when it becomes available. Otherwise it does the same as <a href="index.html#method-describe_prepared"><code>describe_prepared</code></a>.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-send_describe_portal"><a href="#method-send_describe_portal" class="anchor"></a><code><span class="keyword">method</span> send_describe_portal : string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>#send_describe_portal portal_name</code> sends a request for a description of the named portal. The result must be fetched with <a href="index.html#method-get_result"><code>get_result</code></a>.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-set_single_row_mode"><a href="#method-set_single_row_mode" class="anchor"></a><code><span class="keyword">method</span> set_single_row_mode : unit</code></dt><dd><p><code>#set_single_row_mode</code> called right after <a href="index.html#method-send_query"><code>send_query</code></a> or a sibling function causes the returned rows to be split into individual results.</p></dd></dl><dl><dt class="spec method" id="method-get_result"><a href="#method-get_result" class="anchor"></a><code><span class="keyword">method</span> get_result : <span><a href="../class-type-result/index.html">result</a> option</span></code></dt><dd><p><code>get_result</code></p><dl><dt>returns</dt><dd><p><code>Some result</code> of an asynchronous query if available or <code>None</code>.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><aside><p>Copy operations</p></aside><aside><p>Low level</p></aside><dl><dt class="spec method" id="method-put_copy_data"><a href="#method-put_copy_data" class="anchor"></a><code><span class="keyword">method</span> put_copy_data : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="../index.html#type-put_copy_result">put_copy_result</a></code></dt><dd><p><code>put_copy_data ?pos ?len buf</code> sends <code>buf</code> of length <code>len</code> starting at <code>pos</code> to the backend server, which must be in copy-in mode. In non-blocking mode, returns <a href="../index.html#type-put_copy_result.Put_copy_not_queued"><code>Put_copy_not_queued</code></a> if the data was not queued due to full buffers.</p><dl><dt>parameter pos</dt><dd><p>default = 0</p></dd></dl><dl><dt>parameter len</dt><dd><p>default = String.length - pos</p></dd></dl><dl><dt>raises Invalid_argument</dt><dd><p>if the buffer parameters are invalid.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-put_copy_end"><a href="#method-put_copy_end" class="anchor"></a><code><span class="keyword">method</span> put_copy_end : <span>?&#8288;error_msg:string</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="../index.html#type-put_copy_result">put_copy_result</a></code></dt><dd><p><code>put_copy_end ?error_msg ()</code> terminates the copy-in mode, leaving the connection in <code>Command_ok</code> or failed state. In non-blocking mode, returns <a href="../index.html#type-put_copy_result.Put_copy_not_queued"><code>Put_copy_not_queued</code></a> if the termination message was not queued due to full buffers. Also, to ensure delivery of data in non-blocking mode, repeatedly wait for write-ready an call <code>#flush</code>.</p><dl><dt>parameter error_msg</dt><dd><p>if set, force the copy operation to fail with the given message.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-get_copy_data"><a href="#method-get_copy_data" class="anchor"></a><code><span class="keyword">method</span> get_copy_data : <span>?&#8288;async:bool</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="../index.html#type-get_copy_result">get_copy_result</a></code></dt><dd><p><code>get_copy_data ?async ()</code> retrieves the next row of data if available. Only single complete rows are returned. In synchronous mode, the call will wait for completion of the next row. In asynchronous mode it will return immediately with <code>Get_copy_wait</code> if the row transfer is incomplete. In that case, wait for read-ready and call <code>#consume_input</code> before retrying.</p><dl><dt>parameter async</dt><dd><p>default = false</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-getline"><a href="#method-getline" class="anchor"></a><code><span class="keyword">method</span> getline : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> Stdlib.Bytes.t <span>&#45;&gt;</span> <a href="../index.html#type-getline_result">getline_result</a></code></dt><dd><p><code>getline ?pos ?len buf</code> reads a newline-terminated line of at most <code>len</code> characters into <code>buf</code> starting at position <code>pos</code>.</p><dl><dt>returns</dt><dd><p>getline_result</p></dd></dl><dl><dt>parameter pos</dt><dd><p>default = 0</p></dd></dl><dl><dt>parameter len</dt><dd><p>default = Bytes.length buf - pos</p></dd></dl><dl><dt>raises Invalid_argument</dt><dd><p>if the buffer parameters are invalid.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-getline_async"><a href="#method-getline_async" class="anchor"></a><code><span class="keyword">method</span> getline_async : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> Stdlib.Bytes.t <span>&#45;&gt;</span> <a href="../index.html#type-getline_async_result">getline_async_result</a></code></dt><dd><p><code>getline_async ?pos ?len buf</code> reads a newline-terminated line of at most <code>len</code> characters into <code>buf</code> starting at position <code>pos</code> (asynchronously). No need to call <code>endcopy</code> after receiving <code>EndOfData</code>.</p><dl><dt>returns</dt><dd><p>getline_async_result</p></dd></dl><dl><dt>parameter pos</dt><dd><p>default = 0</p></dd></dl><dl><dt>parameter len</dt><dd><p>default = Bytes.length buf - pos</p></dd></dl><dl><dt>raises Invalid_argument</dt><dd><p>if the buffer parameters are invalid.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-putline"><a href="#method-putline" class="anchor"></a><code><span class="keyword">method</span> putline : string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>putline str</code> sends <code>str</code> to backend server. Don't use this method for binary data, use putnbytes instead!</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-putnbytes"><a href="#method-putnbytes" class="anchor"></a><code><span class="keyword">method</span> putnbytes : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>putnbytes ?pos ?len buf</code> sends the substring of <code>buf</code> of length <code>len</code> starting at <code>pos</code> to backend server (use this method for binary data).</p><dl><dt>parameter pos</dt><dd><p>default = 0</p></dd></dl><dl><dt>parameter len</dt><dd><p>default = String.length buf - pos</p></dd></dl><dl><dt>raises Invalid_argument</dt><dd><p>if the buffer parameters are invalid.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-endcopy"><a href="#method-endcopy" class="anchor"></a><code><span class="keyword">method</span> endcopy : unit</code></dt><dd><p><code>endcopy</code> synchronizes with the backend.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><aside><p>High level</p></aside><dl><dt class="spec method" id="method-copy_out"><a href="#method-copy_out" class="anchor"></a><code><span class="keyword">method</span> copy_out : <span>(string <span>&#45;&gt;</span> unit)</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>copy_out f</code> applies <code>f</code> to each line returned by backend server.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-copy_out_channel"><a href="#method-copy_out_channel" class="anchor"></a><code><span class="keyword">method</span> copy_out_channel : Stdlib.out_channel <span>&#45;&gt;</span> unit</code></dt><dd><p><code>copy_out_channel ch</code> sends each line returned by backend server to output channel <code>ch</code>.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-copy_in_channel"><a href="#method-copy_in_channel" class="anchor"></a><code><span class="keyword">method</span> copy_in_channel : Stdlib.in_channel <span>&#45;&gt;</span> unit</code></dt><dd><p><code>copy_in_channel ch</code> sends each line in input channel <code>ch</code> to backend server.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><aside><p>Asynchronous operations and non blocking mode</p></aside><dl><dt class="spec method" id="method-connect_poll"><a href="#method-connect_poll" class="anchor"></a><code><span class="keyword">method</span> connect_poll : <a href="../index.html#type-polling_status">polling_status</a></code></dt><dd><p>After creating a connection with <code>~startonly:true</code>, <a href="index.html#method-connect_poll"><code>connect_poll</code></a> must be called a number of times before the connection can be used. The precise procedure is described in the libpq manual, but the following code should capture the idea, assuming monadic concurrency primitives <code>return</code> and <code>&gt;&gt;=</code> along with polling functions <code>wait_for_read</code> and <code>wait_for_write</code>:</p><pre><code class="ml">let my_async_connect () =
  let c = new connection () in
  let rec establish_connection = function
    | Polling_failed | Polling_ok -&gt; return c
    | Polling_reading -&gt; wait_for_read c#socket &gt;&gt;= fun () -&gt;
                         establish_connection c#connect_poll
    | Polling_writing -&gt; wait_for_write c#socket &gt;&gt;= fun () -&gt;
                         establish_connection c#connect_poll in
  establish_connection Polling_writing</code></pre><p>See also <code>examples/async.ml</code>.</p></dd></dl><dl><dt class="spec method" id="method-reset_start"><a href="#method-reset_start" class="anchor"></a><code><span class="keyword">method</span> reset_start : bool</code></dt><dd><p>An asynchronous variant of <a href="index.html#method-reset"><code>reset</code></a>. Use <a href="index.html#method-reset_poll"><code>reset_poll</code></a> to finish re-establishing the connection.</p></dd></dl><dl><dt class="spec method" id="method-reset_poll"><a href="#method-reset_poll" class="anchor"></a><code><span class="keyword">method</span> reset_poll : <a href="../index.html#type-polling_status">polling_status</a></code></dt><dd><p>Used analogously to <a href="index.html#method-connect_poll"><code>connect_poll</code></a> after calling <a href="index.html#method-reset_start"><code>reset_start</code></a>.</p></dd></dl><dl><dt class="spec method" id="method-set_nonblocking"><a href="#method-set_nonblocking" class="anchor"></a><code><span class="keyword">method</span> set_nonblocking : bool <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_nonblocking b</code> sets state of the connection to nonblocking if <code>b</code> is true and to blocking otherwise.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-is_nonblocking"><a href="#method-is_nonblocking" class="anchor"></a><code><span class="keyword">method</span> is_nonblocking : bool</code></dt><dd><p><code>is_nonblocking</code></p><dl><dt>returns</dt><dd><p>the blocking status of the connection.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-consume_input"><a href="#method-consume_input" class="anchor"></a><code><span class="keyword">method</span> consume_input : unit</code></dt><dd><p><code>consume_input</code> consume any available input from backend.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-is_busy"><a href="#method-is_busy" class="anchor"></a><code><span class="keyword">method</span> is_busy : bool</code></dt><dd><p><code>is_busy</code></p><dl><dt>returns</dt><dd><p>busy status of a query.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-flush"><a href="#method-flush" class="anchor"></a><code><span class="keyword">method</span> flush : <a href="../index.html#type-flush_status">flush_status</a></code></dt><dd><p><code>flush</code> attempts to flush any data queued to the backend.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-socket"><a href="#method-socket" class="anchor"></a><code><span class="keyword">method</span> socket : int</code></dt><dd><p><code>socket</code> obtains the file descriptor for the backend connection socket as an integer.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-request_cancel"><a href="#method-request_cancel" class="anchor"></a><code><span class="keyword">method</span> request_cancel : unit</code></dt><dd><p><code>request_cancel</code> requests that PostgreSQL abandon processing of the current command.</p><dl><dt>raises Error</dt><dd><p>if there is a connection or cancel error.</p></dd></dl></dd></dl><aside><p>Large objects</p></aside><dl><dt class="spec method" id="method-lo_creat"><a href="#method-lo_creat" class="anchor"></a><code><span class="keyword">method</span> lo_creat : <a href="../index.html#type-oid">oid</a></code></dt><dd><p><code>lo_creat</code> creates a new large object and returns its oid.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-lo_import"><a href="#method-lo_import" class="anchor"></a><code><span class="keyword">method</span> lo_import : string <span>&#45;&gt;</span> <a href="../index.html#type-oid">oid</a></code></dt><dd><p><code>lo_import filename</code> imports an operating system file given by <code>filename</code> as a large object.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-lo_export"><a href="#method-lo_export" class="anchor"></a><code><span class="keyword">method</span> lo_export : <a href="../index.html#type-oid">oid</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>lo_export oid filename</code> exports the large object given by <code>oid</code> to an operating system file given by <code>filename</code>.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-lo_open"><a href="#method-lo_open" class="anchor"></a><code><span class="keyword">method</span> lo_open : <a href="../index.html#type-oid">oid</a> <span>&#45;&gt;</span> <a href="../index.html#type-large_object">large_object</a></code></dt><dd><p><code>lo_open oid</code> opens the large object given by <code>oid</code> for reading and writing.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-lo_write"><a href="#method-lo_write" class="anchor"></a><code><span class="keyword">method</span> lo_write : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="../index.html#type-large_object">large_object</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>lo_write ?pos ?len buf lo</code> writes <code>len</code> bytes of buffer <code>buf</code> starting at position <code>pos</code> to large object <code>lo</code>.</p><dl><dt>parameter pos</dt><dd><p>default = 0</p></dd></dl><dl><dt>parameter len</dt><dd><p>default = String.length buf - pos</p></dd></dl><dl><dt>raises Invalid_argument</dt><dd><p>if the buffer parameters are invalid.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if <code>len</code> bytes could not be written.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-lo_write_ba"><a href="#method-lo_write_ba" class="anchor"></a><code><span class="keyword">method</span> lo_write_ba : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> <span><span>(char,Â Stdlib.Bigarray.int8_unsigned_elt,Â Stdlib.Bigarray.c_layout)</span> Stdlib.Bigarray.Array1.t</span> <span>&#45;&gt;</span> <a href="../index.html#type-large_object">large_object</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>As <code>lo_write</code>, but performs a zero-copy write from the given Bigarray.</p></dd></dl><dl><dt class="spec method" id="method-lo_read"><a href="#method-lo_read" class="anchor"></a><code><span class="keyword">method</span> lo_read : <a href="../index.html#type-large_object">large_object</a> <span>&#45;&gt;</span> <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> Stdlib.Bytes.t <span>&#45;&gt;</span> int</code></dt><dd><p><code>lo_read lo ?pos ?len buf</code> reads <code>len</code> bytes from large object <code>lo</code> to buffer <code>buf</code> starting at position <code>pos</code>.</p><dl><dt>parameter pos</dt><dd><p>default = 0</p></dd></dl><dl><dt>parameter len</dt><dd><p>default = Bytes.length buf - pos</p></dd></dl><dl><dt>raises Invalid_argument</dt><dd><p>if the buffer parameters are invalid.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if <code>len</code> bytes could not be read.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-lo_read_ba"><a href="#method-lo_read_ba" class="anchor"></a><code><span class="keyword">method</span> lo_read_ba : <a href="../index.html#type-large_object">large_object</a> <span>&#45;&gt;</span> <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> <span><span>(char,Â Stdlib.Bigarray.int8_unsigned_elt,Â Stdlib.Bigarray.c_layout)</span> Stdlib.Bigarray.Array1.t</span> <span>&#45;&gt;</span> int</code></dt><dd><p>As <code>lo_read</code>, but performs a zero-copy read into the given Bigarray.</p></dd></dl><dl><dt class="spec method" id="method-lo_seek"><a href="#method-lo_seek" class="anchor"></a><code><span class="keyword">method</span> lo_seek : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;whence:<a href="../index.html#type-seek_cmd">seek_cmd</a></span> <span>&#45;&gt;</span> <a href="../index.html#type-large_object">large_object</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>lo_seek ?pos ?whence lo</code> seeks read/write position <code>pos</code> in large object <code>lo</code> relative to the start, current read/write position, or end of the object (<code>whence</code> is SEEK_SET, SEEK_CUR, SEEK_END respectively).</p><dl><dt>parameter pos</dt><dd><p>default = 0</p></dd></dl><dl><dt>parameter whence</dt><dd><p>default = <code>SEEK_SET</code></p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-lo_tell"><a href="#method-lo_tell" class="anchor"></a><code><span class="keyword">method</span> lo_tell : <a href="../index.html#type-large_object">large_object</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>lo_tell lo</code></p><dl><dt>returns</dt><dd><p>current read/write position of large object <code>lo</code>.</p></dd></dl><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-lo_close"><a href="#method-lo_close" class="anchor"></a><code><span class="keyword">method</span> lo_close : <a href="../index.html#type-large_object">large_object</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>lo_close lo</code> closes large object <code>lo</code>.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-lo_unlink"><a href="#method-lo_unlink" class="anchor"></a><code><span class="keyword">method</span> lo_unlink : <a href="../index.html#type-oid">oid</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>lo_unlink oid</code> removes the large object specified by <code>oid</code> from the database.</p><dl><dt>raises Error</dt><dd><p>if there is a connection error.</p></dd></dl></dd></dl><aside><p>Escaping</p></aside><dl><dt class="spec method" id="method-escape_string"><a href="#method-escape_string" class="anchor"></a><code><span class="keyword">method</span> escape_string : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string</code></dt><dd><p><code>escape_string ?pos ?len str</code> escapes ASCII-substring <code>str</code> of length <code>len</code> starting at position <code>pos</code> for use within SQL.</p><dl><dt>parameter pos</dt><dd><p>default = 0</p></dd></dl><dl><dt>parameter len</dt><dd><p>default = String.length str - pos</p></dd></dl></dd></dl><dl><dt class="spec method" id="method-escape_bytea"><a href="#method-escape_bytea" class="anchor"></a><code><span class="keyword">method</span> escape_bytea : <span>?&#8288;pos:int</span> <span>&#45;&gt;</span> <span>?&#8288;len:int</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string</code></dt><dd><p><code>escape_bytea ?pos ?len str</code> escapes binary substring <code>str</code> of length <code>len</code> starting at position <code>pos</code> for use within SQL.</p><dl><dt>parameter pos</dt><dd><p>default = 0</p></dd></dl><dl><dt>parameter len</dt><dd><p>default = String.length str - pos</p></dd></dl></dd></dl></div></body></html>